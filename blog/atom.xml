<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://rheatin.github.io/blog</id>
    <title>Char ONE Blog</title>
    <updated>2022-08-01T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://rheatin.github.io/blog"/>
    <subtitle>Char ONE Blog</subtitle>
    <icon>https://rheatin.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Install Openwrt in PVE with LXC]]></title>
        <id>install-openwrt-in-pve-with-lxc</id>
        <link href="https://rheatin.github.io/blog/install-openwrt-in-pve-with-lxc"/>
        <updated>2022-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Preface]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="preface">Preface<a class="hash-link" href="#preface" title="Direct link to heading">â€‹</a></h2><p>This artical is just a reminder for myself, not a tutorial. Hopefully it helps you too.ðŸ˜„</p><p>My configuration is as below:</p><table><thead><tr><th align="center">Accessory</th><th align="center">Type</th></tr></thead><tbody><tr><td align="center">CPU</td><td align="center">Intel i7-6700</td></tr><tr><td align="center">MOTHERBOARD</td><td align="center">ASUS Z170 Pro Gaming</td></tr><tr><td align="center">NET ADAPTER</td><td align="center">RTL 8125B(with 2 2.5G RJ45)</td></tr><tr><td align="center">DISKS</td><td align="center">Q200EX 480G,PM961A 256G,ZFS:1TB</td></tr><tr><td align="center">SYSTEM</td><td align="center">PVE 7.2-4</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a class="hash-link" href="#steps" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-lxc-template">Create the LXC template<a class="hash-link" href="#create-the-lxc-template" title="Direct link to heading">â€‹</a></h3><p>Here I used is the <strong>slim</strong> release of <a href="https://github.com/klever1988/nanopi-openwrt" target="_blank" rel="noopener noreferrer">nanopi-openwrt</a> made by <strong>klever1988</strong> for that it is simple enough but with the basic extensions installed(<em>e.g. FULLCONE, Argon Theme</em>).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="enter-in-template-folder-with-pve-shell">Enter in template folder with PVE shell.<a class="hash-link" href="#enter-in-template-folder-with-pve-shell" title="Direct link to heading">â€‹</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /var/lib/vz/template/cache/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="download-the-firmware-you-like">Download the firmware you like<a class="hash-link" href="#download-the-firmware-you-like" title="Direct link to heading">â€‹</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/klever1988/nanopi-openwrt/releases/download/2022-07-08/x86-slim.img.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>If the image you download is <code>rootfs.tar.gz</code>, you can jump to <a href="#create-the-lxc-container">Create the LXC container</a>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mount-all-the-partitions-in-this-raw-disk-image">Mount all the partitions in this raw disk image<a class="hash-link" href="#mount-all-the-partitions-in-this-raw-disk-image" title="Direct link to heading">â€‹</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpartx -av x86-slim.img.gz </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Under the <code>/dev/mapper</code>, there are 2 <strong><em>loopXpY</em></strong>, one of this contains the Openwrt System.(<em>e.g. loop0p1</em>)</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mount-it-to-path-mnt">Mount it to path <code>/mnt</code><a class="hash-link" href="#mount-it-to-path-mnt" title="Direct link to heading">â€‹</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> /dev/mapper/loop0p1 /mnt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="package">Package<a class="hash-link" href="#package" title="Direct link to heading">â€‹</a></h4><p>Package it to <code>rootfs.tar.gz</code></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zcvf openwrt-x86-64-generic-rootfs.tar.gz /mnt/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="unmount">Unmount<a class="hash-link" href="#unmount" title="Direct link to heading">â€‹</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">umount</span><span class="token plain"> /mnt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kpartx -d x86-slim.img.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-lxc-container">Create the LXC container<a class="hash-link" href="#create-the-lxc-container" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pve-cli-commands">PVE CLI Commands<a class="hash-link" href="#pve-cli-commands" title="Direct link to heading">â€‹</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pct create </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">vmid</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ostemplate</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OPTIONS</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th align="center">Name</th><th align="left">type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center"><kbd>vmid</kbd></td><td align="left"><code>integer</code>(<strong>1-N</strong>)</td><td align="left">The (<strong>unique</strong>) ID of the VM</td></tr><tr><td align="center"><kbd>ostemplate</kbd></td><td align="left"><code>string</code></td><td align="left">The OS template or backup file (<code>local:vztmpl/openwrt-x86-64-generic-rootfs.tar.gz</code>)</td></tr></tbody></table><h5 class="anchor anchorWithStickyNavbar_LWe7" id="options">Options<a class="hash-link" href="#options" title="Direct link to heading">â€‹</a></h5><table><thead><tr><th align="center">Name</th><th align="left">type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center"><kbd>--rootfs</kbd></td><td align="left"><code>storage</code>:<code>disksize</code></td><td align="left">Use volume as container root.</td></tr><tr><td align="center"><kbd>--ostype</kbd></td><td align="left"><code>alpine</code> or <code>debian</code> etc.</td><td align="left">OS type.</td></tr><tr><td align="center"><kbd>--hostname</kbd></td><td align="left"><code>string</code></td><td align="left">Set a host name for the container.</td></tr><tr><td align="center"><kbd>--arch</kbd></td><td align="left"><code>amd64</code>,<code>arm64</code>,<code>armhf</code>,<code>i386</code></td><td align="left">OS architecture type.</td></tr><tr><td align="center"><kbd>--cores</kbd></td><td align="left"><code>integer</code>(<strong>1-8192</strong>)</td><td align="left">The number of cores assigned</td></tr><tr><td align="center"><kbd>--memory</kbd></td><td align="left"><code>integer</code>(<strong>16-N</strong>)</td><td align="left">Amount of RAM for the VM in MB.</td></tr><tr><td align="center"><kbd>--swap</kbd></td><td align="left"><code>integer</code>(<strong>0-N</strong>)</td><td align="left">Amount of SWAP for the VM in MB.</td></tr></tbody></table><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>PCT Commands</div><div class="admonitionContent_S0QG"><p>The more detailed infomation about PVE is available at <a href="https://pve.proxmox.com/pve-docs/pct.1.html" target="_blank" rel="noopener noreferrer">PCT-DOCs</a>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="initialize-a-lxc-container">Initialize a LXC container<a class="hash-link" href="#initialize-a-lxc-container" title="Direct link to heading">â€‹</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pct create </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local:vztmpl/openwrt-x86-64-generic-rootfs.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --rootfs local-lvm:8 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --ostype unmanaged </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --hostname openwrt </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --arch amd64 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cores </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --memory </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --swap </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -net0 </span><span class="token assign-left variable" style="color:#36acaa">bridge</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vmbr1,name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eth1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Char ONE</name>
        </author>
        <category label="openwrt" term="openwrt"/>
        <category label="PVE" term="PVE"/>
        <category label="LXC" term="LXC"/>
    </entry>
</feed>