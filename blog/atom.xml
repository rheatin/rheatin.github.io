<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://rheatin.github.io/blog</id>
    <title>Char's Arcade Blog</title>
    <updated>2022-08-01T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://rheatin.github.io/blog"/>
    <subtitle>Char's Arcade Blog</subtitle>
    <icon>https://rheatin.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Install Openwrt in PVE with LXC]]></title>
        <id>install-openwrt-in-pve-with-lxc</id>
        <link href="https://rheatin.github.io/blog/install-openwrt-in-pve-with-lxc"/>
        <updated>2022-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Introduction]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">â€‹</a></h2><blockquote><p>Reference(PlagiarismðŸ¤£):</p><p><a href="https://www.right.com.cn/forum/thread-4053183-1-1.html" target="_blank" rel="noopener noreferrer">https://www.right.com.cn/forum/thread-4053183-1-1.html</a>
<a href="https://blog.csdn.net/kangzeru/article/details/115373587" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/kangzeru/article/details/115373587</a></p></blockquote><p>ðŸ˜„This artical is just a <strong>reminder</strong> for myself, not a tutorial. Hopefully it helps you too.</p><p>My configuration is as below:</p><table><thead><tr><th align="center">Accessory</th><th align="center">Type</th></tr></thead><tbody><tr><td align="center">CPU</td><td align="center">Intel i7-6700</td></tr><tr><td align="center">MOTHERBOARD</td><td align="center">ASUS Z170 Pro Gaming</td></tr><tr><td align="center">NET ADAPTER</td><td align="center">RTL 8125B(with 2 2.5G RJ45)</td></tr><tr><td align="center">DISKS</td><td align="center">Q200EX 480G,PM961A 256G,ZFS:1TB</td></tr><tr><td align="center">SYSTEM</td><td align="center">PVE 7.2-4</td></tr></tbody></table><p>The network topology is as below:<img loading="lazy" alt="topology" src="/assets/images/topology-27cc65db2b00301028e8afb1601207ed.jpg" width="1483" height="850" class="img_ev3q"></p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>I've found a repository <a href="https://github.com/fw867/pve-edge-kernel" target="_blank" rel="noopener noreferrer"><strong>pve-edge-kernel</strong></a>, it seems to cover configuration and template of LXC openwrt. Anyone interested can hava a try on your own.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a class="hash-link" href="#steps" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-lxc-template">Create the LXC template<a class="hash-link" href="#create-the-lxc-template" title="Direct link to heading">â€‹</a></h3><p>Here I used is the <strong>slim</strong> release of <a href="https://github.com/klever1988/nanopi-openwrt" target="_blank" rel="noopener noreferrer">nanopi-openwrt</a> made by <strong>klever1988</strong> for that it is simple enough but with the basic extensions installed(<em>e.g. FULLCONE, Argon Theme</em>).</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>If your PVE lacks FULLCONE, you may need to build it from the source.
Here attached the <a href="https://blog.sxx1314.com/linux/587.html" target="_blank" rel="noopener noreferrer"><strong>tutorial</strong></a></p></div></div><p>Download the firmware you like</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /var/lib/vz/template/cache/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/klever1988/nanopi-openwrt/releases/download/2022-07-08/x86-slim.img.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>If the image you've downloaded is <code>rootfs.tar.gz</code>, you can jump to <a href="#create-the-lxc-container"><strong>Create the LXC container</strong></a>.</p></div></div><p>Mount all the partitions in this raw disk image</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kpartx -av x86-slim.img</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Under the <code>/dev/mapper</code>, there are 2 <strong><em>loopXpY</em></strong>, one of this contains the Openwrt System.(<em>e.g. loop0p1</em>)</p><p>Mount it to path <code>/mnt</code></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> /dev/mapper/loop0p1 /mnt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Package it to <code>rootfs.tar.gz</code></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zcvf openwrt-x86-64-generic-rootfs.tar.gz /mnt/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Unmount</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">umount</span><span class="token plain"> /mnt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kpartx -d x86-slim.img</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-lxc-container">Create the LXC container<a class="hash-link" href="#create-the-lxc-container" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pve-cli-commands">PVE CLI Commands<a class="hash-link" href="#pve-cli-commands" title="Direct link to heading">â€‹</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pct create </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">vmid</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ostemplate</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OPTIONS</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th align="center">Name</th><th align="left">type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center"><kbd>vmid</kbd></td><td align="left"><code>integer</code>(<strong>1-N</strong>)</td><td align="left">The (<strong>unique</strong>) ID of the VM</td></tr><tr><td align="center"><kbd>ostemplate</kbd></td><td align="left"><code>string</code></td><td align="left">The OS template or backup file (<code>local:vztmpl/openwrt-x86-64-generic-rootfs.tar.gz</code>)</td></tr></tbody></table><h5 class="anchor anchorWithStickyNavbar_LWe7" id="options">Options<a class="hash-link" href="#options" title="Direct link to heading">â€‹</a></h5><table><thead><tr><th align="center">Name</th><th align="left">type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center"><kbd>--rootfs</kbd></td><td align="left"><code>storage</code>:<code>disksize</code></td><td align="left">Use volume as container root.</td></tr><tr><td align="center"><kbd>--ostype</kbd></td><td align="left"><code>alpine</code> or <code>debian</code> etc.</td><td align="left">OS type.</td></tr><tr><td align="center"><kbd>--hostname</kbd></td><td align="left"><code>string</code></td><td align="left">Set a host name for the container.</td></tr><tr><td align="center"><kbd>--arch</kbd></td><td align="left"><code>amd64</code>,<code>arm64</code>,<code>armhf</code>,<code>i386</code></td><td align="left">OS architecture type.</td></tr><tr><td align="center"><kbd>--cores</kbd></td><td align="left"><code>integer</code>(<strong>1-8192</strong>)</td><td align="left">The number of cores assigned</td></tr><tr><td align="center"><kbd>--memory</kbd></td><td align="left"><code>integer</code>(<strong>16-N</strong>)</td><td align="left">Amount of RAM for the VM in MB.</td></tr><tr><td align="center"><kbd>--swap</kbd></td><td align="left"><code>integer</code>(<strong>0-N</strong>)</td><td align="left">Amount of SWAP for the VM in MB.</td></tr></tbody></table><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>PCT Commands</div><div class="admonitionContent_S0QG"><p>The more detailed infomation about PVE is available at <a href="https://pve.proxmox.com/pve-docs/pct.1.html" target="_blank" rel="noopener noreferrer">PCT-DOCs</a>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="initialize-a-lxc-container">Initialize a LXC container<a class="hash-link" href="#initialize-a-lxc-container" title="Direct link to heading">â€‹</a></h4><p>With the upper commands, we can initialize a container</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pct create </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local:vztmpl/openwrt-x86-64-generic-rootfs.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --rootfs local-lvm:8 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --ostype unmanaged </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --hostname openwrt </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --arch amd64 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cores </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --memory </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --swap </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -net0 </span><span class="token assign-left variable" style="color:#36acaa">bridge</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">vmbr1,name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eth1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="modify-the-configuration-of-container">Modify the configuration of container<a class="hash-link" href="#modify-the-configuration-of-container" title="Direct link to heading">â€‹</a></h4><p>Add the content of below:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/pve/lxc/100.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># there are some basic configurations in openwrt.common.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># which is already existed in PVE system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lxc.include: /usr/share/lxc/config/openwrt.common.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># allow /dev/ppp for openwrt dial up with PPPOE protocal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lxc.cgroup.devices.allow: c </span><span class="token number" style="color:#36acaa">108</span><span class="token plain">:0 rwm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># assign a specific hookscript</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hookscript: local:snippets/hookscript.pl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Passthrough the physical network card for container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lxc.net.1.type: phys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lxc.net.1.link: enp6s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lxc.net.1.flags: up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>The container will always load the <code>/usr/share/lxc/config/openwrt.common.conf</code> whatever you add it to the configuration of lxc container or not</p></div></div><div class="theme-admonition theme-admonition-important alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>If you will use <kbd>openclash</kbd> in your container or happen to see the error with this format <strong>"Unable to set capabilities <em>[sth.]</em> ..."</strong>, you need to modify the <code>openwrt.common.conf</code></p><p>Comment this 2 lines in below file.(<strong><em>[sth.]</em></strong> you lack, and the line where it locates should be commented)</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/usr/share/lxc/config/openwrt.common.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># lxc.cap.drop is meant to discard some capabilities</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lxc.cap.drop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sys_ptrace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lxc.cap.drop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sys_resource</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-hookscript">Create the hookscript<a class="hash-link" href="#create-the-hookscript" title="Direct link to heading">â€‹</a></h4><p>Here we used the official example <code>guest-example-hookscript.pl</code> to modify</p><p>Create the folder</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /var/lib/vz/snippets</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Copy the <code>guest-example-hookscript.pl</code> to the folder</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /usr/share/pve-docs/examples/guest-example-hookscript.pl /var/lib/vz/snippets/hookscript.pl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Edit this file, you will see the content below at line 36:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/var/lib/vz/snippets/hookscript.pl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Second phase 'post-start' will be executed after the guest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># successfully started.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"$vmid started successfully.\n"</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Add the content below to enable <strong>TUN</strong> and <strong>PPPOE</strong>:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/var/lib/vz/snippets/hookscript.pl</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Second phase 'post-start' will be executed after the guest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># successfully started.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"lxc-device add -n $vmid /dev/ppp"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"lxc-device add -n $vmid /dev/net/tun"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"$vmid started successfully.\n"</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="start-the-lxc-container">Start the LXC container<a class="hash-link" href="#start-the-lxc-container" title="Direct link to heading">â€‹</a></h3><p>Start the specific container with <code>VMID</code> and then start the LXC terminal</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pct start </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lxc-attach </span><span class="token number" style="color:#36acaa">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Configure your network</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/etc/config/network</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option name </span><span class="token string" style="color:#e3116c">'br-lan'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'bridge'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list ports </span><span class="token string" style="color:#e3116c">'eth1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config interface </span><span class="token string" style="color:#e3116c">'lan'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option device </span><span class="token string" style="color:#e3116c">'br-lan'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option proto </span><span class="token string" style="color:#e3116c">'static'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option ipaddr </span><span class="token string" style="color:#e3116c">'192.168.1.5'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option netmask </span><span class="token string" style="color:#e3116c">'255.255.255.0'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config interface </span><span class="token string" style="color:#e3116c">'wan'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option device </span><span class="token string" style="color:#e3116c">'enp6s0'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option proto </span><span class="token string" style="color:#e3116c">'pppoe'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option username </span><span class="token string" style="color:#e3116c">'xxxxxx'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option password </span><span class="token string" style="color:#e3116c">'xxxxxx'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Restart the network and firewall</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/etc/init.d/network restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/init.d/firewall restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="start-surfing-on-the-internet">Start surfing on the Internet<a class="hash-link" href="#start-surfing-on-the-internet" title="Direct link to heading">â€‹</a></h2><p><strong>ðŸŽ‰Congratulations!</strong><br>
<!-- -->Now, you may already have Internet access. You can add further configuration such as installing plugins, adjusting your settings with web interface at <a href="http://192.168.1.5" target="_blank" rel="noopener noreferrer">http://192.168.1.5</a></p>]]></content>
        <author>
            <name>Char ONE</name>
        </author>
        <category label="openwrt" term="openwrt"/>
        <category label="PVE" term="PVE"/>
        <category label="LXC" term="LXC"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Welcome]]></title>
        <id>welcome</id>
        <link href="https://rheatin.github.io/blog/welcome"/>
        <updated>2022-07-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hello]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hello">Hello<a class="hash-link" href="#hello" title="Direct link to heading">â€‹</a></h2><p>Hello, Everyone!ðŸ˜„</p>]]></content>
        <author>
            <name>Char ONE</name>
        </author>
        <category label="Welcome" term="Welcome"/>
    </entry>
</feed>